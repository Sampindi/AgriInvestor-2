{% extends "base.html" %}

{% block content %}
<section class="project-details">
    <div class="container">
        {% if is_new %}
            <div class="profile-card">
                <div class="profile-header">
                    <h1>Create New Project</h1>
                    <p>Showcase your agricultural project to potential investors</p>
                </div>
                <div class="profile-body">
                    <form method="POST" action="{{ url_for('new_project') }}" class="fade-in">
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            <div class="col-md-8 mb-4">
                                <div class="form-group">
                                    {{ form.title.label(class="form-label") }}
                                    {% if form.title.errors %}
                                        {{ form.title(class="form-control is-invalid") }}
                                        <div class="invalid-feedback">
                                            {% for error in form.title.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ form.title(class="form-control", placeholder="Enter a compelling title for your project") }}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="form-group">
                                    {{ form.category.label(class="form-label") }}
                                    {% if form.category.errors %}
                                        {{ form.category(class="form-select is-invalid") }}
                                        <div class="invalid-feedback">
                                            {% for error in form.category.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ form.category(class="form-select") }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="form-group">
                                    {{ form.location.label(class="form-label") }}
                                    {% if form.location.errors %}
                                        {{ form.location(class="form-control is-invalid") }}
                                        <div class="invalid-feedback">
                                            {% for error in form.location.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ form.location(class="form-control", placeholder="City, State") }}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="form-group">
                                    {{ form.funding_goal.label(class="form-label") }}
                                    {% if form.funding_goal.errors %}
                                        {{ form.funding_goal(class="form-control is-invalid") }}
                                        <div class="invalid-feedback">
                                            {% for error in form.funding_goal.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ form.funding_goal(class="form-control", placeholder="Amount in USD") }}
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="form-group">
                                    {{ form.duration.label(class="form-label") }}
                                    {% if form.duration.errors %}
                                        {{ form.duration(class="form-control is-invalid") }}
                                        <div class="invalid-feedback">
                                            {% for error in form.duration.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ form.duration(class="form-control", placeholder="Number of days") }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group mb-4">
                            {{ form.description.label(class="form-label") }}
                            {% if form.description.errors %}
                                {{ form.description(class="form-control is-invalid", rows=6) }}
                                <div class="invalid-feedback">
                                    {% for error in form.description.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% else %}
                                {{ form.description(class="form-control", rows=6, placeholder="Describe your project in detail. Include information about what you're planning to do, why it matters, how the funds will be used, and what benefits investors can expect.") }}
                            {% endif %}
                        </div>
                        
                        <div class="form-group d-flex justify-content-between">
                            <a href="{{ url_for('dashboard') }}" class="btn btn-outline">Cancel</a>
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="row">
                <div class="col-lg-8">
                    <!-- Project Images Section -->
                    <div class="project-images">
                        <img src="https://pixabay.com/get/g839a8657ad2757fe0563f9eba0af3e962e7560020a682d9fe2e2f9b20b7f10e26479ad7452edef732a7e3e6d2d92276be6259949e687c10742850d74878b6a00_1280.jpg" alt="{{ project.title }}" class="project-main-image">
                        <div class="project-thumbnails">
                            <img src="https://pixabay.com/get/g839a8657ad2757fe0563f9eba0af3e962e7560020a682d9fe2e2f9b20b7f10e26479ad7452edef732a7e3e6d2d92276be6259949e687c10742850d74878b6a00_1280.jpg" alt="{{ project.title }}" class="project-thumbnail active">
                            <img src="https://pixabay.com/get/g54b2f5d288231e280461b470150ca13c0a8135769984ef0229ba65b472eee72b26a6b000e5c9a1462844441477991537b3767a7a061c3a0aa725ae38f534cc62_1280.jpg" alt="{{ project.title }}" class="project-thumbnail">
                            <img src="https://pixabay.com/get/g47214d070798abedcdb7dd98f1f970d67e088bc86a2ae88edd6d77039ef6b0707ee11ea335e259fa33ae2d591ea109dcd5b3d4681f65f86ce0a484868e00f045_1280.jpg" alt="{{ project.title }}" class="project-thumbnail">
                        </div>
                    </div>
                    
                    <!-- Project Info Section -->
                    <div class="project-info">
                        <h1>{{ project.title }}</h1>
                        
                        <div class="project-meta">
                            <div class="project-meta-item">
                                <span class="project-meta-icon"><i class="fas fa-map-marker-alt"></i></span>
                                <span class="project-meta-text">{{ project.location }}</span>
                            </div>
                            <div class="project-meta-item">
                                <span class="project-meta-icon"><i class="fas fa-tag"></i></span>
                                <span class="project-meta-text">{{ project.category }}</span>
                            </div>
                            <div class="project-meta-item">
                                <span class="project-meta-icon"><i class="fas fa-calendar-alt"></i></span>
                                <span class="project-meta-text">{{ format_date(project.created_at) }}</span>
                            </div>
                            <div class="project-meta-item">
                                <span class="project-meta-icon"><i class="fas fa-clock"></i></span>
                                <span class="project-meta-text">{{ project.duration }} days duration</span>
                            </div>
                        </div>
                        
                        <!-- Project Description -->
                        <div class="project-description">
                            <h3>About This Project</h3>
                            <p>{{ project.description }}</p>
                        </div>
                        
                        <!-- Farmer Info -->
                        <div class="farmer-info">
                            <h3>About the Farmer</h3>
                            <div class="d-flex">
                                <div class="farmer-avatar me-3">
                                    <!-- Placeholder avatar -->
                                    <div style="width: 60px; height: 60px; background-color: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-primary); font-size: 24px;">
                                        {{ farmer.username[0].upper() }}
                                    </div>
                                </div>
                                <div>
                                    <h4>{{ farmer.username }}</h4>
                                    <p>Member since {{ format_date(farmer.created_at) }}</p>
                                    
                                    {% if current_user.is_authenticated and current_user.id != farmer.id %}
                                        <a href="{{ url_for('send_message', recipient_id=farmer.id) }}" class="btn btn-sm btn-outline">Contact Farmer</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Edit Form (for project owner) -->
                        {% if current_user.is_authenticated and current_user.id == project.farmer_id and form %}
                            <div class="edit-project mt-5">
                                <h3>Edit Project</h3>
                                <form method="POST" action="{{ url_for('project_detail', project_id=project.id) }}">
                                    {{ form.hidden_tag() }}
                                    
                                    <div class="form-group mb-3">
                                        {{ form.title.label(class="form-label") }}
                                        {% if form.title.errors %}
                                            {{ form.title(class="form-control is-invalid") }}
                                            <div class="invalid-feedback">
                                                {% for error in form.title.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            {{ form.title(class="form-control") }}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-group mb-3">
                                                {{ form.location.label(class="form-label") }}
                                                {% if form.location.errors %}
                                                    {{ form.location(class="form-control is-invalid") }}
                                                    <div class="invalid-feedback">
                                                        {% for error in form.location.errors %}
                                                            {{ error }}
                                                        {% endfor %}
                                                    </div>
                                                {% else %}
                                                    {{ form.location(class="form-control") }}
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mb-3">
                                                {{ form.funding_goal.label(class="form-label") }}
                                                {% if form.funding_goal.errors %}
                                                    {{ form.funding_goal(class="form-control is-invalid") }}
                                                    <div class="invalid-feedback">
                                                        {% for error in form.funding_goal.errors %}
                                                            {{ error }}
                                                        {% endfor %}
                                                    </div>
                                                {% else %}
                                                    {{ form.funding_goal(class="form-control") }}
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-group mb-3">
                                                {{ form.category.label(class="form-label") }}
                                                {% if form.category.errors %}
                                                    {{ form.category(class="form-select is-invalid") }}
                                                    <div class="invalid-feedback">
                                                        {% for error in form.category.errors %}
                                                            {{ error }}
                                                        {% endfor %}
                                                    </div>
                                                {% else %}
                                                    {{ form.category(class="form-select") }}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group mb-3">
                                        {{ form.description.label(class="form-label") }}
                                        {% if form.description.errors %}
                                            {{ form.description(class="form-control is-invalid", rows=6) }}
                                            <div class="invalid-feedback">
                                                {% for error in form.description.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            {{ form.description(class="form-control", rows=6) }}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-group mb-3">
                                        {{ form.duration.label(class="form-label") }}
                                        {% if form.duration.errors %}
                                            {{ form.duration(class="form-control is-invalid") }}
                                            <div class="invalid-feedback">
                                                {% for error in form.duration.errors %}
                                                    {{ error }}
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            {{ form.duration(class="form-control") }}
                                        {% endif %}
                                    </div>
                                    
                                    <div class="form-group">
                                        {{ form.submit(class="btn btn-primary") }}
                                    </div>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <!-- Project Funding Section -->
                    <div class="project-funding">
                        <h3 class="project-funding-title">Funding</h3>
                        <div class="project-funding-amount">{{ format_currency(total_invested or 0) }}</div>
                        <div class="project-funding-goal">raised of {{ format_currency(project.funding_goal) }} goal</div>
                        
                        <div class="project-funding-progress">
                            <div class="project-funding-progress-bar" style="width: 0%" data-width="{{ progress }}"></div>
                        </div>
                        
                        <div class="project-funding-stats">
                            <div class="project-funding-stat">
                                <div class="project-funding-stat-number">{{ investments|length }}</div>
                                <div class="project-funding-stat-text">Investors</div>
                            </div>
                            <div class="project-funding-stat">
                                <div class="project-funding-stat-number">{{ progress|int }}%</div>
                                <div class="project-funding-stat-text">Funded</div>
                            </div>
                            <div class="project-funding-stat">
                                <div class="project-funding-stat-number">{{ project.duration }}</div>
                                <div class="project-funding-stat-text">Days Left</div>
                            </div>
                        </div>
                        
                        {% if current_user.is_authenticated and current_user.user_type == 'investor' and current_user.id != project.farmer_id %}
                            <!-- Investment Form -->
                            <form method="POST" action="{{ url_for('project_detail', project_id=project.id) }}" class="mt-4">
                                {{ investment_form.hidden_tag() }}
                                
                                <div class="form-group mb-3">
                                    {{ investment_form.amount.label(class="form-label") }}
                                    {% if investment_form.amount.errors %}
                                        {{ investment_form.amount(class="form-control is-invalid") }}
                                        <div class="invalid-feedback">
                                            {% for error in investment_form.amount.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        {{ investment_form.amount(class="form-control", placeholder="Enter investment amount") }}
                                    {% endif %}
                                </div>
                                
                                <div class="form-group">
                                    {{ investment_form.submit(class="btn btn-primary w-100 btn-lg") }}
                                </div>
                            </form>
                        {% elif not current_user.is_authenticated %}
                            <div class="text-center mt-4">
                                <p>You need to be logged in as an investor to invest in this project.</p>
                                <a href="{{ url_for('login') }}" class="btn btn-primary">Log In</a>
                                <a href="{{ url_for('register') }}" class="btn btn-outline ms-2">Register</a>
                            </div>
                        {% elif current_user.user_type == 'farmer' and current_user.id != project.farmer_id %}
                            <div class="text-center mt-4">
                                <p>Only investors can invest in projects.</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Project Details Card -->
                    <div class="dashboard-card mt-4">
                        <h3 class="mb-3">Project Details</h3>
                        
                        <div class="profile-info-item">
                            <div class="profile-info-label">Category:</div>
                            <div class="profile-info-value">{{ project.category }}</div>
                        </div>
                        <div class="profile-info-item">
                            <div class="profile-info-label">Location:</div>
                            <div class="profile-info-value">{{ project.location }}</div>
                        </div>
                        <div class="profile-info-item">
                            <div class="profile-info-label">Duration:</div>
                            <div class="profile-info-value">{{ project.duration }} days</div>
                        </div>
                        <div class="profile-info-item">
                            <div class="profile-info-label">Created:</div>
                            <div class="profile-info-value">{{ format_date(project.created_at) }}</div>
                        </div>
                    </div>
                    
                    <!-- Share Section -->
                    <div class="dashboard-card mt-4">
                        <h3 class="mb-3">Share This Project</h3>
                        <div class="d-flex gap-2">
                            <a href="#" class="btn btn-outline flex-grow-1"><i class="fab fa-facebook-f"></i> Share</a>
                            <a href="#" class="btn btn-outline flex-grow-1"><i class="fab fa-twitter"></i> Tweet</a>
                            <a href="#" class="btn btn-outline flex-grow-1"><i class="fas fa-envelope"></i> Email</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Similar Projects Section -->
            <div class="similar-projects mt-5">
                <h2 class="mb-4">Similar Projects</h2>
                <div class="row">
                    <!-- Placeholder for similar projects -->
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img src="https://pixabay.com/get/g54b2f5d288231e280461b470150ca13c0a8135769984ef0229ba65b472eee72b26a6b000e5c9a1462844441477991537b3767a7a061c3a0aa725ae38f534cc62_1280.jpg" alt="Similar Project" class="card-img-top">
                            <div class="card-body">
                                <h4>Organic Vegetable Farm Expansion</h4>
                                <p class="text-secondary"><i class="fas fa-map-marker-alt"></i> California, USA</p>
                                <div class="progress mb-2">
                                    <div class="progress-bar" style="width: 65%"></div>
                                </div>
                                <p class="d-flex justify-content-between">
                                    <span>65% funded</span>
                                    <span class="text-primary">$65,000</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img src="https://pixabay.com/get/g88f2a3a95ab9cc8e72cfaa32380a38859fef66ee9795efe17ec2eba7f6b438daf0ab2323d394232a483cce9516e55fd9d928d87689a5e153add62051d5b1e051_1280.jpg" alt="Similar Project" class="card-img-top">
                            <div class="card-body">
                                <h4>Sustainable Irrigation System</h4>
                                <p class="text-secondary"><i class="fas fa-map-marker-alt"></i> Texas, USA</p>
                                <div class="progress mb-2">
                                    <div class="progress-bar" style="width: 40%"></div>
                                </div>
                                <p class="d-flex justify-content-between">
                                    <span>40% funded</span>
                                    <span class="text-primary">$28,000</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img src="https://pixabay.com/get/g384b8cdfb65db3be587c8146baa1b9c4d9aacdc1bb3a224326d7c448591d4bd9bf4d977e81455c38cff411fc8c0a3db1a54addd1a090c659e68abec3af3cb49c_1280.jpg" alt="Similar Project" class="card-img-top">
                            <div class="card-body">
                                <h4>Agricultural Drone Monitoring</h4>
                                <p class="text-secondary"><i class="fas fa-map-marker-alt"></i> Iowa, USA</p>
                                <div class="progress mb-2">
                                    <div class="progress-bar" style="width: 85%"></div>
                                </div>
                                <p class="d-flex justify-content-between">
                                    <span>85% funded</span>
                                    <span class="text-primary">$42,500</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}
